#乌斯拉尔移除克莱门条约
USR_remove_treaty_clemen = {
	USR = {
		if = {
			limit = { has_idea = USR_the_clemen_treaty }
			remove_ideas = USR_the_clemen_treaty
		}
		else_if = {
			limit = { has_idea = USR_the_clemen_treaty_1 }
			remove_ideas = USR_the_clemen_treaty_1
		}
		else_if = {
			limit = { has_idea = USR_the_clemen_treaty_2 }
			remove_ideas = USR_the_clemen_treaty_2
		}
		else_if = {
			limit = { has_idea = USR_the_clemen_treaty_3 }
			remove_ideas = USR_the_clemen_treaty_3
		}
	}
}

#狠狠得爆破乌斯拉尔
USR_let_be_brokenz = {
	USR_remove_treaty_clemen = yes
	set_cosmetic_tag = USR_PROVISIONAL
	USR = {
		add_country_leader_role = {
			character = USR_Minna
			country_leader = {
				ideology= sub_Junta
				desc = USR_another_leader_Minna_desc
				traits={ USR_high_efficient_politics USR_wwi_hero }
				expire="3200.1.1.1"
			}
			promote_leader = yes
		}
		add_popularity = {
			ideology = neutrality
			popularity = 0.5
		}
		set_politics = {
			ruling_party = neutrality
			elections_allowed = no 
			last_election = "3090.2.17"
			election_frequency = 48
		}
		set_country_leader_portrait = {
			portrait = GFX_Minna
		}
		USR_retire_vice_country_leader = yes
		add_ideas = USR_another_leader_Edytha
		USR_Hanna = {
			set_nationality = RZT
		}
		USR_Zeppelin = {
			set_nationality = RHB
		}
		USR_Bismark = {
			set_nationality = RHB
			add_country_leader_role = {
				character = USR_Bismark
				country_leader = {
					ideology= sub_Junta
					desc = USR_Bismark_desc
					traits={ USR_prince_of_golden_shamrock }
					expire="3200.1.1.1"
				}
				promote_leader = yes
			}
		}
		USR_Yiliyasifeier = {
			set_nationality = HSP
			promote_leader = yes
		}
	}
	for_each_scope_loop = {
		array = USR.core_states
		add_core_of = BGT
		add_core_of = HSP
		add_core_of = RBW
		add_core_of = OST
		add_core_of = RZT
		#抱歉琴魔，时机未到
		#add_core_of = SCK
		add_core_of = PMB
		add_core_of = RHB
	}
	HSP = { 
		transfer_state = 174 
		transfer_state = 682
		set_country_leader_name = {
			name = USR_Yiliyasifeier
		}
		set_country_leader_portrait = {
			portrait = GFX_Yiliyasifeier
		}
		set_country_leader_description = {
			desc = USR_Yiliyasifeier_desc
		}
		set_country_leader_name = {
			name = USR_Yiliyasifeier
		}
	}
	RBW = {
		transfer_state = 159 
		transfer_state = 760 
	}
	OST = {
		transfer_state = 202
		transfer_state = 197
		transfer_state = 179
		transfer_state = 764
	}
	RHB = {
		transfer_state = 138 
		transfer_state = 722 
		transfer_state = 763
	}
	PMB = {
		transfer_state = 155
		transfer_state = 765
	}
	
	RZT = {
		transfer_state = 177
		transfer_state = 723
		transfer_state = 160
		transfer_state = 762
		transfer_state = 761
		puppet = PMB
	}
	PMB = {
		
		set_country_leader_name = {
			name = PMB_Rudolfine
		}
		set_country_leader_portrait = {
			portrait = GFX_Rudolfine
		}
		set_country_leader_description = {
			desc = PMB_Rudolfine_desc
		}
		set_country_leader_name = {
			name = PMB_Rudolfine
		}
		add_country_leader_trait = PMB_the_bird_in_cage
	}
	USR = {
		create_faction = USR_Salvation_Front
		add_to_faction = KST
		add_to_faction = BGT
		add_to_faction = RHB
	}
	RZT = {
		create_faction = USR_Rhine_Hispania_Alliance
		add_to_faction = OST
		add_to_faction = HSP
		add_to_faction = RBW
	}
	# SCK = {
	# 	transfer_state = 120
	# 	transfer_state = 144
	# }
	RZT = {
		declare_war_on = {
			target = USR
			type = take_core_state
		}
	}
	add_civil_war_target = RZT
	OST = {
		add_to_war = {
			targeted_alliance = RZT
			enemy = USR
		}
	}
	add_civil_war_target = OST
	HSP = {
		add_to_war = {
			targeted_alliance = RZT
			enemy = USR
		}
	}
	add_civil_war_target = HSP
	RBW = {
		add_to_war = {
			targeted_alliance = RZT
			enemy = USR
		}
	}
	add_civil_war_target = RBW
	PMB = {
		add_to_war = {
			targeted_alliance = RZT
			enemy = USR
		}
	}
	add_civil_war_target = PMB
	BGT = {
		add_to_war = {
			targeted_alliance = USR
			enemy = RZT
		}
	}
	add_civil_war_target = BGT
	KST = {
		add_to_war = {
			targeted_alliance = USR
			enemy = RZT
		}
	}
	add_civil_war_target = KST
	RHB = {
		add_to_war = {
			targeted_alliance = USR
			enemy = RZT
		}
	}
	add_civil_war_target = RHB
}

#移除副领导人
USR_retire_vice_country_leader = {
	if = {
		limit = { has_idea = USR_another_leader_Minna }
		remove_ideas = USR_another_leader_Minna
	}
	if = {
		limit = { has_idea = USR_another_leader_Erika }
		remove_ideas = USR_another_leader_Erika
	}
	if = {
		limit = { has_idea = USR_another_leader_Adolfine }
		remove_ideas = USR_another_leader_Adolfine
	}
	if = {
		limit = { has_idea = USR_another_leader_Wagner }
		remove_ideas = USR_another_leader_Wagner
	}
}

#加入战车道联盟阵营
USR_refresh_SSD_alliance_members = {
	for_each_scope_loop = {
		array = USR.faction_members
		if = {
			limit = {
				NOT = {
					is_in_array = {
						array = global.SSD_alliance_members
						value = THIS.id
					}
				}
				THIS = {
					NOT = { is_puppet_of = USR }
				}
				USR = { is_faction_leader = yes }
			}
			add_to_array = {
				array = global.SSD_alliance_members
				value = THIS.id
			}
			#添加dm
			THIS = { 
				add_dynamic_modifier = {
					modifier = USR_senshado_alliance_dm
				}
			}
			USR_refresh_faction_effect = yes
		}
	}
}

#刷新阵营加成效果MONTHLY
USR_refresh_faction_effect = {
	#刷新dm数值(为战车道联盟)
	if = {
		limit = {
			USR_is_leading_SSDA = yes
		}
		for_each_loop = {
			array = global.SSD_alliance_members
			add_to_temp_variable = { ssda_md_base = 1.5 }
			if = {
				limit = { USR = { has_completed_focus = USR_real_nishizumi_ryu } }
				add_to_temp_variable = { ssda_md_base = 1.5 }
			}
		}
		divide_temp_variable = {
			ssda_md_base = 100
		}
		USR = {
			
			set_variable = {
				usr_ssd_alliance_dm_armor = global.ssda_md_base
			}
			set_variable = {
				usr_ssd_alliance_dm_morale = global.ssda_md_base
			}
			subtract_from_temp_variable = {
				ssda_md_base_alt = global.ssda_md_base
			}
			set_variable = {
				usr_ssd_alliance_dm_exploss = ssda_md_base_alt
			}
		}
	}
}

#添加邮票
USR_add_stamp_utility = {
	USR = {
		set_variable = {
			usr_stamp_factor = Stamp_ID_list^num
		}
		divide_variable = {
			usr_stamp_factor = 100
		}
		# remove_dynamic_modifier = {
		# 	modifier = USR_post_stamp_dynamic_modifier
		# }
		# add_dynamic_modifier = {
		# 	modifier = USR_post_stamp_dynamic_modifier
		# }
		set_country_flag = USR_NEW_POST_STAMP
	}
}

#刷新milestone
USR_refresh_milestone = {
	USR = {
		set_variable = {
			usr_milestone_factor = surrender_progress
		}
		divide_variable = {
			usr_milestone_factor = 2
		}
	}
}